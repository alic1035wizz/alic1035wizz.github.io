(()=>{"use strict";!function(e){let t=new Image;t.onload=t.onerror=function(){!function(e){let t=e?"webp":"no-webp";document.documentElement.classList.add(t)}(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}();const e=(e,t)=>{e.wrap.innerHTML="",e.input.value=t.currentTarget.textContent,e.input.setAttribute("value",t.currentTarget.textContent)},t=[],a=document.querySelector(".orders__list"),r=document.querySelector(".road__list");let n=0,s=0;const o=()=>{n<3&&(a.innerHTML+=t[s].order,r.innerHTML+=t[n].roadItem,n++,s++)};(()=>{const e=document.querySelector(".orders__more"),o=document.querySelector(".road__show"),d=e=>{if("order"===e)for(let e=0;e<Math.min(3,t.length-s);e++)a.innerHTML+=t[s].order,s++;if("road"===e)for(let e=0;e<Math.min(3,t.length-n);e++)r.innerHTML+=t[n].roadItem,n++};e.addEventListener("click",d.bind(null,"order")),o.addEventListener("click",d.bind(null,"road"))})();const d=document.querySelector(".form-order__addr input"),l=document.querySelector(".cites"),c={item:null,input:d,wrap:l};let i=((e,t=300)=>{let a;return(...r)=>{clearTimeout(a),a=setTimeout((()=>{e.apply(void 0,r)}),t)}})((t=>{d.value.length<1||fetch(`https://api.geoapify.com/v1/geocode/autocomplete?text=${d.value}&format=json&apiKey=8e01b239842444148b628ba779696433`,{method:"GET"}).then((e=>e.json())).then((t=>{const a=document.createDocumentFragment();t.results.forEach((t=>{const r=document.createElement("li");r.classList.add("city"),r.textContent=t.formatted,a.append(r),c.item=t,r.addEventListener("click",e.bind(null,c))})),l.innerHTML="",l.append(a)})).catch((e=>console.log("error",e)))}),300);d.addEventListener("input",i),document.addEventListener("click",(e=>{l.innerHTML=""})),(e=>{const a=document.querySelector(".form-order");a.addEventListener("submit",(r=>{r.preventDefault(),e.item?(((e,a)=>{const r=((e,t)=>{const a=55.81056975,r={latitude:e,longitude:t},n=e=>e*Math.PI/180,s=n(r.latitude-a),o=n(r.longitude-37.793542),d=Math.sin(s/2)**2,l=Math.sin(o/2)**2,c=d+Math.cos(n(a))*Math.cos(n(r.latitude))*l;return(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371).toFixed(2)})(e.lat,e.lon),d=(e=>{const t=1e3*e/6e4*60,a=Math.round(t),r=Math.ceil(a/60);return a<60?`${a}мин`:`${r}ч ${a%60}мин`})(r);let l=`<li class="orders__item">\n                        <h2 class="title">Заказ №${n+1}</h2>\n                        <div class="orders__data orders__data-addr">\n                            <h3 class="orders__preview">Адрес доставки</h3>\n                            <p class="orders__descr">${a.address.value}</p>\n                        </div>\n                        <div class="orders__data orders__data-cord">\n                            <h3 class="orders__preview">Координаты</h3>\n                            <p class="orders__descr orders__descr--cord"><span>${e.lat}</span><span>${e.lon}</span></p>\n                        </div>\n                        <div class="orders__data orders__data-long">\n                            <h3 class="orders__preview">Расстояние</h3>\n                            <p class="orders__descr">${r}км</p>\n                        </div>\n                    </li>`,c=`<li class="road__item">\n                        <span class="road__number">${s+1}</span>\n                        <h3 class="title road__title">Заказ №${s+1}</h3>\n                        <p class="road__text road__text-to">\n                            <span class="road__subtitle">Адрес доставки</span>\n                            <span class="road__descr">${a.address.value}</span>\n                        </p>\n                        <p class="road__text road__text-time">\n                            <span class="road__subtitle">Время доставки</span>\n                            <span class="road__descr">${d}</span>\n                        </p>\n                        <p class="road__text road__text-weight">\n                            <span class="road__subtitle">Вес посылки</span>\n                            <span class="road__descr">${a.weight.value}</span>\n                        </p>\n                        <p class="road__text road__text-volume">\n                            <span class="road__subtitle">Затртаты аккумулятора</span>\n                            <span class="road__descr">6.6%</span>\n                    </p>\n                </li>`;t.push({order:l,roadItem:c}),o()})(e.item,a),(()=>{const e=document.querySelectorAll(".footer__item"),t=document.querySelectorAll("[data-id-menu]");e.forEach(((e,t)=>{e.classList.remove("footer__item--current"),1===t&&e.classList.add("footer__item--current")})),t.forEach((e=>{e.classList.remove("layer--active"),2==+e.dataset.idMenu&&e.classList.add("layer--active")}))})(),e.item=null,e.input.value="",a.weight.value=""):(e.input.value="Пожалуйста, введите город из списка.",e.input.style.color="red",setTimeout((()=>{e.input.removeAttribute("style")}),3e3))}))})(c),window.addEventListener("load",(()=>{const e=document.querySelector(".bg-start");e.classList.add("bg-start--remove"),setTimeout((()=>{e.style.display="none"}),2500),(()=>{const e=document.querySelectorAll(".footer__link"),t=document.querySelectorAll(".footer__item"),a=document.querySelectorAll("[data-id-menu]");e.forEach(((e,r)=>e.addEventListener("click",(n=>{n.preventDefault(),t.forEach((e=>e.classList.remove("footer__item--current"))),e.closest(".footer__item").classList.add("footer__item--current"),a.forEach((e=>{e.classList.remove("layer--active"),+e.dataset.idMenu===r+1&&e.classList.add("layer--active")}))}))))})(),((e=55.751574,t=37.573856)=>{ymaps.ready((function(){var a=new ymaps.Map("map",{center:[e,t],zoom:8,controls:[]}),r=new ymaps.Placemark(a.getCenter(),{hintContent:"Собственный значок метки",balloonContent:"Это красивая метка"},{iconLayout:"default#image",iconImageHref:"../img/map/icon_map.png",iconImageSize:[41,41]});a.geoObjects.add(r)}))})()}))})();